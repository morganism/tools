.TH MANDARIN 1 "February 2026" "mandarin 2.0.0" "User Commands"
."
." Generated by doc_generator.rb v2.0.0
."
.SH NAME
mandarin \- A standalone, manifest-driven installer that reads *.install.json files and performs install, uninstall, check, or list operations for CLI tools.
.SH SYNOPSIS
.B mandarin.rb --manifest <file.install.json> <action> [options]
.SH DESCRIPTION
mandarin.rb solves the problem of repeatedly writing bespoke install scripts for each CLI tool by providing a single, reusable installer that is driven entirely by a JSON manifest. It exists as a permanent toolbox utility: point it at any *.install.json (produced by a companion doc_generator.rb) and it handles binary installation, man page placement, config file setup, dependency verification, and clean uninstallation.
.PP
The script parses CLI flags with OptionParser, auto-discovers a lone *.install.json in the working directory if --manifest is omitted, and loads the JSON manifest into a Hash. All filesystem side-effects (mkdir, install, cp, rm, chmod) pass through a unified act() gate that respects --dry-run (print-only) and --sudo (prefix commands) flags, ensuring no mutations occur during simulation. Dependency checking inspects Ruby version via Gem::Version, probes gems with Kernel#gem, locates system binaries with `which`, and validates environment variables. The four actions (--install, --uninstall, --check, --list) are dispatched via a case statement, each implemented as a top-level method that walks manifest sections (binary, man_pages, config_dirs, config_files) in order.
.SH OPTIONS
.TP
.B -m, --manifest FILE
Path to the *.install.json manifest to operate on. Auto-discovered if exactly one exists in cwd.
.TP
.B --install
Install binary, man pages, config dirs/files, and verify dependencies.
.TP
.B --uninstall
Remove all installed files (except config files, which are never auto-deleted).
.TP
.B --check
Verify dependencies and display the install plan without changing anything.
.TP
.B --list
Print a human-readable summary of the manifest contents.
.TP
.B -n, --dry-run
Simulate --install or --uninstall: print every action that would be taken without writing or removing any files.
.TP
.B -p, --prefix DIR
Override the install prefix directory (default: read from manifest or /usr/local).
.TP
.B --sudo
Prefix filesystem and shell commands with sudo for privileged installation.
.TP
.B --force
Overwrite existing files that would otherwise cause the installer to abort.
.TP
.B -v, --verbose
Show each command as it is executed.
.TP
.B -V, --version
Print the version string and exit.
.TP
.B -h, --help
Print usage help and exit.
.SH EXAMPLES
.PP
.B Example 1:
.PP
.RS 4
.EX
mandarin.rb -m mytool.install.json --check
.EE
.RE
.PP
.B Example 2:
.PP
.RS 4
.EX
mandarin.rb -m mytool.install.json --install --dry-run
.EE
.RE
.PP
.B Example 3:
.PP
.RS 4
.EX
mandarin.rb -m mytool.install.json --install --sudo
.EE
.RE
.PP
.B Example 4:
.PP
.RS 4
.EX
mandarin.rb -m mytool.install.json --install --prefix ~/.local --verbose
.EE
.RE
.PP
.B Example 5:
.PP
.RS 4
.EX
mandarin.rb -m mytool.install.json --install --force
.EE
.RE
.PP
.B Example 6:
.PP
.RS 4
.EX
mandarin.rb -m mytool.install.json --uninstall --dry-run
.EE
.RE
.PP
.B Example 7:
.PP
.RS 4
.EX
mandarin.rb --list
.EE
.RE
.SH ENVIRONMENT
.TP
.B HOME
Used to expand ~ in manifest paths (via Dir.home).
.SH FILES
.TP
.I *.install.json
JSON manifest file describing the tool to install: binary info, man pages, dependencies, config dirs/files, and post-install notes.
.TP
.I mandarin.rb
The installer script itself.
.SH DEPENDENCIES
Requires Ruby 3.0+.
.SS Ruby Gems

.SS System Binaries
.TP
.B install
Package: coreutils. Required
.TP
.B mandb
Package: man-db. Optional
.TP
.B sudo
Package: sudo. Optional
.SH "EXIT STATUS"
.TP
.B 0
Success — action completed (or dry-run printed) without errors.
.TP
.B 1
Blocking dependency issues found, missing source file, file already exists without --force, or missing/invalid arguments.
.SH BUGS
Shell injection is possible if manifest fields contain malicious characters, since values are interpolated into system() calls without escaping. The `which` check uses a bare system() call rather than Ruby's built-in File/PATH lookup. Config files are never auto-removed on uninstall, which is intentional but may surprise users expecting a clean teardown.
.SH NOTES
The act() helper creates a single chokepoint for every side-effect, making the dry-run mode trivially correct rather than scattering conditionals throughout the code. Config files are deliberately never auto-removed during uninstall — a safety-first design choice that avoids destroying user customisation. ANSI colour output uses 256-colour orange tones (xterm 208/214/130) with graceful tty detection fallback, giving the tool a distinctive 'citrus' visual identity.
.SH "SEE ALSO"
.BR install (1),
.BR json (1),
.BR mandb (8),
.BR makewhatis (8),
.BR sudo (8),
.BR gem (1),
.BR which (1)
.SH AUTHOR
morgan
.PP
Documentation generated by
.BR doc_generator.rb .
