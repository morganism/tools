.TH MANDARIN 1 "February 2026" "mandarin 2.0.0" "User Commands"
."
." Generated by doc_generator.rb v2.0.0
."
.SH NAME
mandarin \- A standalone, manifest-driven installer that reads *.install.json files and performs install, uninstall, check, or list operations for Ruby-based CLI tools.
.SH SYNOPSIS
.B mandarin.rb --manifest <file.install.json> <action> [options]
.SH DESCRIPTION
mandarin.rb solves the problem of repeatedly writing bespoke install scripts for each CLI tool by providing a single, reusable installer driven by JSON manifests. It reads manifest files (typically produced by a companion doc_generator.rb) and handles binary installation, man page placement, config file copying, dependency verification, and uninstallation — all controlled by a declarative JSON document rather than hard-coded logic.
.PP
The script parses CLI options via OptionParser, auto-discovers a lone *.install.json if --manifest is not given, then dispatches to one of four action handlers: --install, --uninstall, --check, or --list. All file-system side effects are funnelled through a small set of helper functions (fs_mkdir_p, fs_install, fs_cp, fs_rm, fs_chmod) that respect a --dry-run flag via a central act() gate, ensuring nothing is written during simulation. Dependency checking validates Ruby version via Gem::Version, probes gems with Kernel#gem, tests system binaries with `which`, and inspects environment variables. The --sudo flag prefixes shell commands with sudo for system-wide installs, and --prefix allows overriding the installation root directory at runtime.
.SH OPTIONS
.TP
.B -m, --manifest FILE
Path to the *.install.json manifest to operate on. Auto-discovered if exactly one exists in cwd.
.TP
.B --install
Install binary, man pages, config dirs/files, and verify dependencies.
.TP
.B --uninstall
Remove all installed files (except config files, which are never auto-deleted).
.TP
.B --check
Verify dependencies and display the install plan without changing anything.
.TP
.B --list
Print a human-readable summary of the manifest contents.
.TP
.B -n, --dry-run
Simulate --install or --uninstall: print every action that would be taken without writing or removing anything.
.TP
.B -p, --prefix DIR
Override the install prefix directory (default: read from manifest or /usr/local).
.TP
.B --sudo
Prefix file-system and shell commands with sudo for system-wide installs.
.TP
.B --force
Overwrite existing files that would otherwise block installation.
.TP
.B -v, --verbose
Show each command as it is executed.
.TP
.B -V, --version
Print version information and exit.
.TP
.B -h, --help
Print usage help and exit.
.SH EXAMPLES
.PP
.B Example 1:
.PP
.RS 4
.EX
mandarin.rb -m mytool.install.json --check
.EE
.RE
.PP
.B Example 2:
.PP
.RS 4
.EX
mandarin.rb -m mytool.install.json --install --dry-run
.EE
.RE
.PP
.B Example 3:
.PP
.RS 4
.EX
mandarin.rb -m mytool.install.json --install --sudo
.EE
.RE
.PP
.B Example 4:
.PP
.RS 4
.EX
mandarin.rb -m mytool.install.json --install --prefix ~/.local --verbose
.EE
.RE
.PP
.B Example 5:
.PP
.RS 4
.EX
mandarin.rb -m mytool.install.json --install --force
.EE
.RE
.PP
.B Example 6:
.PP
.RS 4
.EX
mandarin.rb -m mytool.install.json --uninstall --dry-run
.EE
.RE
.PP
.B Example 7:
.PP
.RS 4
.EX
mandarin.rb -m mytool.install.json --list
.EE
.RE
.SH ENVIRONMENT
.TP
.B HOME
Used to expand ~ in manifest paths (via Dir.home).
.SH FILES
.TP
.I *.install.json
JSON manifest file describing the tool to install — binary location, man pages, dependencies, config files, and post-install notes.
.SH DEPENDENCIES
Requires Ruby 3.0+.
.SS Ruby Gems

.SS System Binaries
.TP
.B install
Package: coreutils. Required
.TP
.B mandb
Package: man-db. Optional
.TP
.B sudo
Package: sudo. Optional
.SH "EXIT STATUS"
.TP
.B 0
Success — requested action completed without errors.
.TP
.B 1
Blocking dependency issues found, source file missing, file already exists without --force, or other fatal error.
.SH BUGS
Shell injection is possible if manifest fields contain malicious values, since several paths are interpolated directly into system() calls. Config directories created during install are not removed during uninstall. The --sudo flag shells out rather than using Ruby privilege escalation, so it requires an interactive sudo session. The `which` lookup for system binaries may behave inconsistently across shells and platforms.
.SH NOTES
The dry-run mode is architecturally clean: every side effect passes through act(), which either yields the block or prints a [DRY] message, so dry-run and real execution share identical code paths. Config files are deliberately never auto-removed during uninstall — a safety-conscious design choice that prevents accidental loss of user customisations. The ANSI colour helpers use 256-colour orange tones (xterm 208/214/130) for branding and degrade gracefully to plain text when stdout is not a TTY.
.SH "SEE ALSO"
.BR install (1),
.BR sudo (8),
.BR mandb (8),
.BR which (1),
.BR gem (1),
.BR jq (1),
.BR ruby (1)
.SH AUTHOR
morgan
.PP
Documentation generated by
.BR doc_generator.rb .
