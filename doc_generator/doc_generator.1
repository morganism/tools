.TH DOC_GENERATOR 1 "February 2026" "doc_generator 1.0.0" "User Commands"
."
." Generated by doc_generator.rb
."
.SH NAME
doc_generator \- Reads a Ruby script, sends it to the Anthropic Claude API for analysis, and generates a GitHub Wiki Markdown page, a plain-text usage/help file, and a groff-formatted man page.
.SH SYNOPSIS
.B doc_generator.rb [options] <script.rb>
.SH DESCRIPTION
It solves the problem of writing and maintaining documentation for Ruby command-line scripts by automating the process with AI. Instead of manually authoring Markdown docs, help text, and man pages, a developer can point this tool at any Ruby script and receive all three documentation artifacts in seconds, ensuring they stay consistent with the actual source code.
.PP
The script parses CLI options with OptionParser, reads the target Ruby file, and constructs a detailed prompt instructing the Anthropic Claude API to return a structured JSON analysis of the script (options, examples, exit codes, etc.). It sends this prompt via Net::HTTP over TLS to the Anthropic Messages API, strips any accidental markdown fences from the response, and parses the resulting JSON. Three generator methods then transform the parsed JSON hash into Markdown (with tables and fenced code blocks), a fixed-width plain-text usage document, and a groff/troff man page with proper macros (.TH, .SH, .TP, .EX/.EE, .BR). All output files are written to a configurable directory using a slug derived from the target script's filename.
.SH OPTIONS
.TP
.B -o, --output DIR
Output directory for generated documentation files (default: current directory)
.TP
.B -s, --section NUM
Man page section number, 1-8 (default: 1)
.TP
.B -a, --author NAME
Author name for the man page header (default: $USER)
.TP
.B -v, --verbose
Print progress messages to stderr
.TP
.B -V, --version
Print version string and exit
.TP
.B -h, --help
Show help/usage information and exit
.SH EXAMPLES
.PP
.B Example 1:
.PP
.RS 4
.EX
doc_generator.rb my_script.rb
.EE
.RE
.PP
.B Example 2:
.PP
.RS 4
.EX
doc_generator.rb -o ./docs my_script.rb
.EE
.RE
.PP
.B Example 3:
.PP
.RS 4
.EX
doc_generator.rb -a 'Jane Doe' -s 1 -v cli_tool.rb
.EE
.RE
.PP
.B Example 4:
.PP
.RS 4
.EX
doc_generator.rb --output /usr/local/share/doc --section 8 admin_tool.rb
.EE
.RE
.PP
.B Example 5:
.PP
.RS 4
.EX
ANTHROPIC_API_KEY=sk-ant-... doc_generator.rb backup.rb
.EE
.RE
.PP
.B Example 6:
.PP
.RS 4
.EX
doc_generator.rb -o ./wiki -a 'Team Dev' -v json_store.rb
.EE
.RE
.PP
.B Example 7:
.PP
.RS 4
.EX
doc_generator.rb -s 6 daemon_config.rb && man ./daemon_config.6
.EE
.RE
.SH ENVIRONMENT
.TP
.B ANTHROPIC_API_KEY
Required. Your Anthropic API key used to authenticate requests to the Claude Messages API.
.TP
.B USER
Optional. Used as the default author name for the man page if --author is not specified.
.SH FILES
.TP
.I <script_name>.md
Generated GitHub Wiki Markdown documentation page
.TP
.I <script_name>_usage.txt
Generated plain-text help/usage output suitable for --help
.TP
.I <script_name>.<section>
Generated groff/troff formatted man page (e.g. script.1)
.SH "EXIT STATUS"
.TP
.B 0
Success — all documentation files were generated and written
.TP
.B 1
No script file specified, file not found, ANTHROPIC_API_KEY not set, invalid man section, API error, or JSON parse failure
.SH BUGS
The script defines a nested method `esc` inside `generate_man` using `def`, which in Ruby actually defines it at the enclosing scope rather than being lexically scoped — this could cause unexpected behavior if called elsewhere. The MAX_TOKENS limit of 4096 may be insufficient for very large or complex scripts, potentially causing truncated JSON responses. There is no retry logic or rate-limit handling for the API call. The word-wrap regex in `generate_usage` may break on very long unbreakable tokens. The version constant is hardcoded and not derived from the generated script.
.SH NOTES
The script is self-referential in nature — it uses an AI prompt that is structurally identical to the kind of documentation it generates, making it effectively able to document itself. It defensively strips markdown code fences from the API response despite explicitly requesting raw JSON, acknowledging the non-deterministic behavior of LLMs. The man page generator includes a regex-based heuristic to detect 'name(section)' patterns in see_also entries and convert them to proper .BR groff macros.
.SH "SEE ALSO"
.BR ruby (1),
.BR groff (1),
.BR man (1),
.BR curl (1),
.BR jq (1),
.B OptionParser (Ruby stdlib),
.BR pandoc (1)
.SH AUTHOR
morgan
.PP
Documentation generated by
.BR doc_generator.rb .
