#!/usr/bin/env bash
: <<DOCXX
________________________________________________________________________________
Usage   : $0 OPTIONS
        :
Desc    : Things what I do
Author  : @author
Date    : @date 
________________________________________________________________________________
DOCXX

{

[[ -f ~/.my_functions ]] && source ~/.my_functions
[[ -f .ansi.colours ]] && source .ansi.colours

echo -e "${Blue}here: ${IBlue}$(THIS_DIR)${NC}"
sleep 1

usage() {
    echo -e "${Red}Missing filename.\n${White}Usage:${Blue} $(basename $0)${IWhite} [-b]${White} file${Reset}"
    echo -e " ${White} where -b FILE .. Create FILE in${IWhite} $HOME${White}/bin${Reset}"
}

dash() {
  # return some '-' chars (default 80)
  n=${1:-80} # how many?
  head -c $n < /dev/zero | tr '\0' '\101'
}

create_or_edit() {
    if [[ -z "$1" ]]; then
        echo -e "${Red}no FILE passed to ${IRed}create_or_edit${Red} function${Reset}"
        return 3
    fi 

    if [[ -f "$HOME/.vib" ]]; then
        source $HOME/.vib   # source default settings file
    fi
    if [[ -f ".vib" ]]; then
        source .vib   # source default settings file
    fi

    if [[ -f "$1" ]]; then
      RP=$(realpath $1)
      echo -e "${dWhite}realpath ${IWhite}$1${dWhite} is: ${RP}${Reset}"    
    else
      echo -e "${Green}${On_White}ðŸ†•${Reset}"
    fi

    SNIPPETS="~/.my_snippets"
    if [[ ! -e $1 ]]; then
      echo '#!/usr/bin/env bash'                            >> $1
      echo ": <<DOCXX"                                      >> $1
      echo "Add description"                                >> $1
      echo "Author: $AUTHOR"                                >> $1
      echo "Date: $(date)"                                  >> $1
      echo "DOCXX"                                          >> $1
      echo ""                                               >> $1
      echo "[[ -f .ansi.colours ]] && source .ansi.colours" >> $1
      echo ""                                               >> $1
    fi
    touch                           $1
    chmod 755                       $1
    vi                              $1
    exit
}

if [[ -z $1 ]]; then
    usage
    return 1   
elif [[ $1 =~ ^-h ]]; then
    usage
    return 1
elif [[ "$1" =~ ^-b ]]; then
    shift

    if [[ -z $1 ]]; then
        echo -e "${Red}-b flag but no FILE Â¿Â¿${Reset}"

        usage
        return 2   
    fi
    ansi
    FILE="$HOME/bin/$1"
    echo -e "${dWhite}file is ${IWhite}${FILE}${Reset}"
    create_or_edit "${FILE}"
fi

DIR="$HOME/bin"
if [[ -f $DIR/$1 ]]; then
    create_or_edit "$DIR/$1" ;
    return 0
else
    if [[ -f $1 ]]; then
        create_or_edit "$1" ;
        return 0
    else
       echo -e "${dBlue}no bin no exist file so create${Reset}"
    fi
fi
echo -e "${Blue}${On_White}${1}${Reset}"
create_or_edit $1

}
