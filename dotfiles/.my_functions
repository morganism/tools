THIS="$(realpath $BASH_SOURCE)"
DIR="$(dirname $THIS)"

LIB_COLOURS="ansi_colours.env"
[[ -f "${DIR}/${LIB_COLOURS}" ]] && source "${DIR}/${LIB_COLOURS}"

# --------------------
colours() {
  # Colors for output
  RED='\033[0;31m'
  GREEN='\033[0;32m'
  YELLOW='\033[1;33m'
  BLUE='\033[1;34m'
  NC='\033[0m' # No Color
}
mcd() {           # create and cd
    [[ -e "$1" ]] && [[ ! -d "$1" ]] && echo "Error: $1 is not a directory" && return 1
    [[ ! -e "$1" ]] && mkdir -p "$1"
    [[ -d "$1" ]] && pushd "$1"
}
progress() {
  local msg="$1"
  local total="${2:-100}"
  local delay="${3:-0.05}"

  echo -n "$msg "
  for ((i=0; i<=total; i++)); do
    printf "\r%s %3d%%" "$msg" "$i"
    sleep "$delay"
  done
  echo -e "\r$msg 100% âœ“"
}

vi_my_aliases() {
  #-----------
  #--- vma ---
  #-----------
  vi ~/.my_aliases
  source ~/.my_aliases
}
vi_my_functions() {
  #-----------
  #--- vmf ---
  #-----------
  vi ~/.my_functions
  source ~/.my_functions
}
config_init() {
  #-----------
  # setup the .config dir structure if not present
  #-----------
  CALL_DIR=$(pwd)
  
  # Colors for output
  RED='\033[0;31m'
  GREEN='\033[0;32m'
  YELLOW='\033[1;33m'
  BLUE='\033[1;34m'
  NC='\033[0m' # No Color

  echo -e "${BLUE}Checking for ${YELLOW}.config${BLUE} directory in ${YELLOW}${CALL_DIR}${BLUE} ... ${NC}"

  if [[ -d "${CALL_DIR}/.config" ]]; then
    echo -e "${YELLOW}.config${GREEN} directory exists.${NC}"
  else
    echo -e "${RED}Missing ${YELLOW}.config ${BLUE} directory structure, creating ... ${NC}"
    CONFIG_DIR="${CALL_DIR}/.config"
    mkdir -p "${CONFIG_DIR}"
    cd "$CONFIG_DIR"
    BSF="${CONFIG_DIR}/bootstrap"
    for f in $(echo "env functions aliases")
    do
      touch $f
      RP=$(realpath $f)
      echo "source $RP" >> "$BSF"
      echo -en "${GREEN} . ${NC}"
    done
    $(chmod 755 "$BSF")
    echo -en "${GREEN} . ${NC}"
  fi
  echo -e "${GREEN}Finished!${NC}"
}
__guess() {
  echo $1
  
}
#cd() {
  #builtin cd "$1" &>/dev/null
  #if [[ "$?" = "0" ]]; then
    #P0=$(realpath "$1")    # actual dest
    #P1="$1"                # typed dest
    #P2=$PWD                # start dir
    #HIST="/tmp/zd.history"
    #H_P0="/tmp/zd.h_p0"
    #echo "$P0:$P1:$P2" >> $HIST
    #cat $HIST | awk -F: '{print $1}' | sort | uniq -c | sort -rn > $H_P0 
  #else
    #echo -e "${IGreen}O${Yellow}p${Cyan}p${Blue}o${Purple}r${BIBlack}t${White}u${Green}n${Red}i${Blue}t${IWhite}y${NC} to guess"
    ##__guess $1
  #fi
#}
open22() {
  if [[ -z "$OPENSSH" ]]; then
    OPENSSH=$(nmap -p22 10.71.157.* --open | grep report | sed -e 's/^.*report for //' -e 's:.* (::' -e 's:)::')
  fi

  echo $OPENSSH
}
linktools() {
  TOOLSDIR="${HOME}/src/morganism/tools"
  if [[ -d $TOOLSDIR ]]; then
    cd $TOOLSDIR
    LINKER_N
    LINKER_CMD="linker"
    if [[ -x "${TOOLSDIR}/${LINKER_CMD}" ]]; then
      echo "Linking tools/bin to ~/bin and tools/dotfiles to ~ ..."
      ./$LINKER_CMD
      echo "Linking exited with: $?"
    else
      echo "Hmmm .. Linker command ${LINKER_CMD} does not exist here: ${TOOLSDIR}/${LINKER_CMD}."
      exit 2
    fi
  else
    echo "Git repo 'tools' [git@github.com:morganism/tools.git] is not checked out in the expected location: ${TOOLSDIR}"
    exit 1
  fi
}

rp2pb() {
  # realpath 2 paste board get the realpath of the file or directory specified as an arg: rp2pb FILE

  realpath $1 | pbcopy
  echo "realpath of $1 is in pasteboard $(pbpaste)"
}

savealias() {
  source ~/.my_aliases
  THE_ALIAS=$(alias $1)
  if [[ -z "${THE_ALIAS}" ]]; then
    echo "Alias $1 not defined. [${THE_ALIAS}][$(${THE_ALIAS})]"
    return 1
  else
    echo "Alias $1 defined. [${THE_ALIAS}][$(${THE_ALIAS})]"
    echo "${THE_ALIAS}" >> ~/.my_aliases
    source ~/.my_aliases
  fi
}

